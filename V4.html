<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Từ vựng Phần 4: Australian values</title>
    <style>
        body {font-family: Arial, sans-serif; background:#f0f8ff; padding:20px; line-height:1.6;}
        h1 {text-align:center; color:#006400; margin:-20px 0 0 10px;}
        h2 {text-align:left; color:#e51803; margin:0 0 15px; font-size:15px;}
        h3 {text-align:right; color:#006400; margin:0; font-size:10px;}
        .controls {background:#fff; padding:15px; border-radius:8px; margin-bottom:20px; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
        select, button {padding:8px 12px; font-size:16px; margin:0 8px 8px 8px 0; border-radius:6px;}
        .notice {color:#d32f2f; font-weight:bold; margin-top:5px;}
        .btn {background:#006400; color:white; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; font-weight:bold;}
        .btn:hover {background:#004d00;}
        
        /* PHẦN MỚI – 3 NÚT FILTER ĐẸP & DỄ BẤM TRÊN ĐIỆN THOẠI */
        .filter-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            justify-content: flex-start;
        }
        .filter-btn {
            padding: 10px 16px;
            background: #e8f5e8;
            border: 2px solid #006400;
            border-radius: 8px;
            font-weight: bold;
            color: #006400;
            min-width: 110px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .filter-btn.active {
            background: #006400;
            color: white;
        }
        /* HẾT PHẦN MỚI */
        
        table {width:100%; border-collapse:collapse; margin-top:20px; background:white; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
        th {background:#006400; color:white; padding:12px; text-align:center;}
        td {padding:10px; vertical-align:top; border-bottom:1px solid #ddd; text-align:center;}
        td.example {font-style:italic; color:#333; font-size:0.95em; text-align:left;}
        tr:nth-child(even) {background:#f9f9f9;}
        tr:hover {background:#e6f7e6;}
        input[type="checkbox"] {transform:scale(1.3); cursor:pointer;}
        .hidden {display:none;}
        .nav-bar {margin:20px 0;}
        .nav-bar .btn {margin:5px; font-size:15px;}
        table, th, td {border:1px solid #000;}
        td, th {padding:6px;}
    </style>
</head>
<body>

<h1>Australian Citizenship - Our Common Bond</h1><h3>Created by Thomas</h3>
<h2>TỪ VỰNG PHẦN 4: AUSTRALIAN VALUES</h2>

<div class="nav-bar">
    <a href="V1.html" class="btn">PART_ONE</a>
    <a href="V2.html" class="btn">PART_TWO</a>
    <a href="V3.html" class="btn">PART_THREE</a>
    <a href="V4.html" class="btn">PART_FOUR</a>
    <a href="Glossary.html" class="btn">Glossary</a>
</div>

<div class="controls">
    <strong>Chọn giọng đọc:</strong>
    <select id="voiceSelect"></select>
    <div id="notice" class="notice" style="display:none;">Không tìm thấy giọng Australian? Cài đặt ngôn ngữ English (Australia) trong máy!</div>
</div>

<!-- PHẦN MỚI – 3 NÚT LỚN DỄ BẤM TRÊN iPHONE -->
<div class="filter-bar">
    <div class="filter-btn active" data-mode="all">Show All</div>
    <div class="filter-btn" data-mode="checked">Show Checked</div>
    <div class="filter-btn" data-mode="unchecked">Show Unchecked</div>
</div>
<!-- HẾT PHẦN MỚI -->

<table id="vocabTable">
    <thead>
        <tr>
            <th>No.</th>
            <th>Options</th>
            <th>Vocabulary</th>
            <th>Pronunciation</th>
            <th>Translation</th>
            <th>Audio</th>
            <th>Example</th>
            <th>Read</th>
        </tr>
    </thead>
    <tbody>
        <!-- Dán hết các <tr> từ vựng của bạn vào đây như cũ -->
        <tr><td>1</td><td><input type="checkbox" class="row-check"></td><td>congratulations</td><td>/kənˌɡrætʃ.uˈleɪ.ʃənz/</td><td>chúc mừng</td><td><button class="btn" onclick="speak('congratulations')">Nghe</button></td><td class="example">Congratulations on choosing to become an Australian citizen. [Chúc mừng bạn đã chọn trở thành công dân Úc.]</td><td><button class="btn" data-sentence="Congratulations on choosing to become an Australian citizen.">Read</button></td></tr>
        <!-- ... các dòng còn lại giữ nguyên ... -->
    </tbody>
</table>

<script>
// === TẤT CẢ CÁC HÀM CŨ VẪN GIỮ NGUYÊN + THÊM MỚI ===
let voices = [];
let originalOrder = [];
let isSorted = false;

const voiceSelect = document.getElementById('voiceSelect');
const notice = document.getElementById('notice');
const tbody = document.querySelector('#vocabTable tbody');
const filterButtons = document.querySelectorAll('.filter-btn');

const STORAGE_PREFIX = 'CITIZENSHIP_VOCAB_' + location.pathname.replace(/[^a-zA-Z0-9]/g, '_');

// Lưu trạng thái
function saveAll() {
    const checked = Array.from(tbody.querySelectorAll('.row-check:checked'))
        .map(cb => cb.closest('tr').cells[0].textContent.trim());
    localStorage.setItem(STORAGE_PREFIX + '_checked', JSON.stringify(checked));
    localStorage.setItem(STORAGE_PREFIX + '_filter', document.querySelector('.filter-btn.active').dataset.mode);
    localStorage.setItem(STORAGE_PREFIX + '_voice', voiceSelect.value);
}

// Khôi phục trạng thái
function loadAll() {
    const savedChecked = localStorage.getItem(STORAGE_PREFIX + '_checked');
    if (savedChecked) {
        const checkedNos = JSON.parse(savedChecked);
        tbody.querySelectorAll('.row-check').forEach(cb => {
            const no = cb.closest('tr').cells[0].textContent.trim();
            cb.checked = checkedNos.includes(no);
        });
    }

    const savedFilter = localStorage.getItem(STORAGE_PREFIX + '_filter') || 'all';
    setActiveFilter(savedFilter);
    filterRows(savedFilter);

    const savedVoice = localStorage.getItem(STORAGE_PREFIX + '_voice');
    if (savedVoice) voiceSelect.dataset.saved = savedVoice;
}

// Đổi nút active + lọc
function setActiveFilter(mode) {
    filterButtons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.mode === mode);
    });
}

filterButtons.forEach(btn => {
    btn.addEventListener('click', () => {
        const mode = btn.dataset.mode;
        setActiveFilter(mode);
        filterRows(mode);
        renumberVisible();
        saveAll();
    });
});

tbody.addEventListener('change', (e) => {
    if (e.target.classList.contains('row-check')) {
        renumberVisible();
        saveAll();
    }
});

voiceSelect.addEventListener('change', saveAll);

document.addEventListener('DOMContentLoaded', () => {
    originalOrder = Array.from(tbody.rows);
    loadVoices();
    loadAll();
    renumberVisible();
});

// === CÁC HÀM CŨ GIỮ NGUYÊN ===
function loadVoices() {
    voices = speechSynthesis.getVoices();
    if (voices.length === 0) {
        speechSynthesis.onvoiceschanged = loadVoices;
        return;
    }
    let ausVoices = voices.filter(v => v.lang === 'en-AU' || v.name.toLowerCase().includes('australian'));
    let otherVoices = voices.filter(v => v.lang.startsWith('en-') && !ausVoices.includes(v));
    voices = [...ausVoices, ...otherVoices];

    voiceSelect.innerHTML = '';
    if (ausVoices.length === 0) notice.style.display = 'block';

    voices.forEach((voice, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        const gender = (voice.name.toLowerCase().includes('female') || ['karen','catherine','lee'].some(n=>voice.name.toLowerCase().includes(n))) ? '(Nữ)' : '(Nam)';
        opt.textContent = `${voice.name} (${voice.lang}) ${gender}`;
        voiceSelect.appendChild(opt);
    });

    const saved = voiceSelect.dataset.saved || localStorage.getItem(STORAGE_PREFIX + '_voice');
    if (saved !== null && voiceSelect.options[saved]) {
        voiceSelect.value = saved;
    } else {
        const ausIdx = voices.findIndex(v => v.lang === 'en-AU');
        voiceSelect.value = ausIdx !== -1 ? ausIdx : 0;
    }
}

function speak(text) {
    speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(text);
    const idx = voiceSelect.value;
    if (idx && voices[idx]) utterance.voice = voices[idx];
    else utterance.lang = 'en-AU';
    utterance.rate = 0.9;
    speechSynthesis.speak(utterance);
}

function filterRows(mode) {
    for (let row of tbody.rows) {
        const checked = row.querySelector('.row-check').checked;
        row.classList.toggle('hidden', 
            mode === 'checked' ? !checked : 
            mode === 'unchecked' ? checked : false
        );
    }
    renumberVisible();
}

function renumberVisible() {
    let count = 1;
    tbody.querySelectorAll('tr').forEach(row => {
        if (!row.classList.contains('hidden')) {
            row.cells[0].textContent = count++;
        }
    });
}

function sortTable() {
    const rows = Array.from(tbody.rows);
    if (!isSorted) {
        rows.sort((a, b) => a.cells[2].textContent.localeCompare(b.cells[2].textContent));
        isSorted = true;
    } else {
        rows.sort((a, b) => originalOrder.indexOf(a) - originalOrder.indexOf(b));
        isSorted = false;
    }
    rows.forEach(r => tbody.appendChild(r));
    renumberVisible();
}

document.querySelectorAll('[data-sentence]').forEach(btn => {
    btn.onclick = () => speak(btn.dataset.sentence);
});
</script>

</body>
</html>

